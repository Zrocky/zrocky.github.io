<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Zrocky, iOS, Python" />








  <link rel="shortcut icon" type="image/x-icon" href="/images/favicon.ico?v=5.1.2" />






<meta name="description" content="fastlane是为iOS和Android应用程序自动执行beta部署和发布的最简单方法。它处理所有繁琐的任务，例如生成屏幕截图，处理代码签名和发布应用程序。">
<meta name="keywords" content="Zrocky, iOS, Python">
<meta property="og:type" content="article">
<meta property="og:title" content="使用fastlane自动部署iOS App">
<meta property="og:url" content="http://zrocky.com/2018/fastlane/index.html">
<meta property="og:site_name" content="Zrocky">
<meta property="og:description" content="fastlane是为iOS和Android应用程序自动执行beta部署和发布的最简单方法。它处理所有繁琐的任务，例如生成屏幕截图，处理代码签名和发布应用程序。">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="http://p9sc3003b.bkt.clouddn.com/2018-09-11-15366328908637.jpg">
<meta property="og:image" content="http://p9sc3003b.bkt.clouddn.com/2018-09-11-15366335231432.jpg">
<meta property="og:image" content="http://p9sc3003b.bkt.clouddn.com/2018-09-11-sighRecording.gif">
<meta property="og:image" content="http://p9sc3003b.bkt.clouddn.com/2018-09-12-PEMRecording.gif">
<meta property="og:updated_time" content="2018-10-15T07:01:49.326Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="使用fastlane自动部署iOS App">
<meta name="twitter:description" content="fastlane是为iOS和Android应用程序自动执行beta部署和发布的最简单方法。它处理所有繁琐的任务，例如生成屏幕截图，处理代码签名和发布应用程序。">
<meta name="twitter:image" content="http://p9sc3003b.bkt.clouddn.com/2018-09-11-15366328908637.jpg">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://zrocky.com/2018/fastlane/"/>





  <title>使用fastlane自动部署iOS App | Zrocky</title>
  




<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', '119024149', 'auto');
  ga('send', 'pageview');
</script>











</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Zrocky</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">Stay Hungry, Stay Foolish</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://zrocky.com/2018/fastlane/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zrocky">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zrocky">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">使用fastlane自动部署iOS App</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-09-12T00:21:47+08:00">
                2018-09-12
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/iOS/" itemprop="url" rel="index">
                    <span itemprop="name">iOS</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2018/fastlane/" class="leancloud_visitors" data-flag-title="使用fastlane自动部署iOS App">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>fastlane是为iOS和Android应用程序自动执行beta部署和发布的最简单方法。它处理所有繁琐的任务，例如生成屏幕截图，处理代码签名和发布应用程序。</p>
<a id="more"></a>
<h2 id="基本使用"><a href="#基本使用" class="headerlink" title="基本使用"></a>基本使用</h2><h3 id="安装fastlane"><a href="#安装fastlane" class="headerlink" title="安装fastlane"></a>安装fastlane</h3><ol>
<li><p>安装最新的Xcode命令行工具</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xcode-select --install</span><br></pre></td></tr></table></figure>
</li>
<li><p>安装fastlane（可以使用RubyGems或Homebrew安装）</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># Using RubyGems</span><br><span class="line">sudo gem install fastlane -NV</span><br><span class="line"></span><br><span class="line"># Alternatively using Homebrew</span><br><span class="line">brew cask install fastlane</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="初始化fastlane"><a href="#初始化fastlane" class="headerlink" title="初始化fastlane"></a>初始化fastlane</h3><p>在Shell中，切换到项目目录并运行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fastlane init</span><br></pre></td></tr></table></figure>
<p><img src="http://p9sc3003b.bkt.clouddn.com/2018-09-11-15366328908637.jpg" alt="fastlane_init"></p>
<p>fastlane提供了几种默认的配置，可以根据实际需求选择，期间可能会要求输入一些配置信息，根据提示输入即可。</p>
<p>根据你选择的配置，会生成不同的配置文件。</p>
<p><img src="http://p9sc3003b.bkt.clouddn.com/2018-09-11-15366335231432.jpg" alt="fastlane_file"></p>
<ul>
<li><code>fastlane/Fastfile</code>包含了发布应用程序所需的所有信息。</li>
<li><code>fastlane/Appfile</code>包含了fastlane工具中使用的基本配置信息（如Apple ID、Bundle identifier等），这些信息可以让你更快地部署<code>lane</code>。<a href="#Appfile">更多</a></li>
<li><code>./Gemfile</code>存储了fastlane所需的依赖条件。<a href="#使用Gemfile进行依赖管理">更多</a></li>
</ul>
<h3 id="使用fastlane发布iOS-App"><a href="#使用fastlane发布iOS-App" class="headerlink" title="使用fastlane发布iOS App"></a>使用fastlane发布iOS App</h3><p>一个App的发布流程，大致分为<code>代码签名</code>、<code>应用构建</code>、<code>发布</code>几个步骤，以下将详细介绍每个步骤</p>
<h4 id="初识lane"><a href="#初识lane" class="headerlink" title="初识lane"></a>初识lane</h4><p><code>Fastlane</code>文件中默认配置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">default_platform(:ios)</span><br><span class="line"></span><br><span class="line">platform :ios do</span><br><span class="line">  desc &quot;Description of what the lane does&quot;</span><br><span class="line">  lane :custom_lane do</span><br><span class="line">    # do something</span><br><span class="line">  end</span><br><span class="line">end</span><br></pre></td></tr></table></figure>
<ul>
<li>每个<code>lane</code>即一个流程，可在这里配置例如Beta部署或发布App Store的操作。</li>
<li><code>platform</code>表示<code>lane</code>所运行的平台</li>
</ul>
<p>在<code>lane</code>中，我们可以使用fastlane创建的<code>action</code>，或者第三方的插件来实现我们所需要的操作。</p>
<p>在Shell中切换到项目根目录，使用以下方法执行<code>lane</code>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fastlane custom_lane</span><br></pre></td></tr></table></figure>
<h4 id="代码签名"><a href="#代码签名" class="headerlink" title="代码签名"></a>代码签名</h4><p>如果你不熟悉代码前面，请查看<a href="https://developer.apple.com/videos/play/wwdc2016/401/" target="_blank" rel="noopener">Xcode代码签名基础知识的WWDC</a></p>
<p>这里使用的<code>action</code>均为自动设置代码签名，如果你已经手动设置好了，且不需要fastlane为你做此项配置，可直接跳到<a href="#构建应用">下一步骤</a>。</p>
<h5 id="match"><a href="#match" class="headerlink" title="match"></a>match</h5><p>通过使用<code>match</code>，可以将私钥和证书存储在Git仓库中，以便跨机器同步它们。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">match(git_url: &quot;https://github.com/fastlane/certificates&quot;,</span><br><span class="line">      type: &quot;adhoc&quot;,</span><br><span class="line">      app_identifier: &quot;tools.fastlane.app&quot;)</span><br></pre></td></tr></table></figure>
<p>关于match的配置方法，我单独写了一篇文章介绍，推荐使用这种方法。<a href="https://zrocky.com/2018/how-to-use-fastlane-match">使用match同步证书和配置文件</a></p>
<p><strong>注意：</strong><code>match</code>会要求您撤销现有证书</p>
<h5 id="cert和sigh"><a href="#cert和sigh" class="headerlink" title="cert和sigh"></a>cert和sigh</h5><p>如果你不想撤销现有证书，但仍想使用自动设置，则可以使用<code>cert</code>和<code>sigh</code>。</p>
<ul>
<li><code>cert</code>将确保你在本地计算机上安装了有效的证书及其私钥</li>
<li><code>sigh</code>将确保你在本地安装了与证书相匹配的有效配置文件</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">lane: beta do</span><br><span class="line">    cert</span><br><span class="line">    sigh(force: true)</span><br></pre></td></tr></table></figure>
<p><code>force: true</code>将确保每次运行时重新生成配置文件。</p>
<h6 id="cert"><a href="#cert" class="headerlink" title="cert"></a>cert</h6><p><code>cert</code>将检查本地计算机上是否安装了任何可用的签名证书。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fastlane cert</span><br></pre></td></tr></table></figure>
<p>只有在需要创建新证书的时候，<code>cert</code>才会</p>
<ul>
<li>创建一个新的私钥</li>
<li>创建新的签名请求</li>
<li>生成、下载和安装证书</li>
<li>将所有生成的文件导入到Keychain中</li>
</ul>
<p><code>cert</code>永远不会撤销你现有的证书。如果无法再创建证书，则<code>cert</code>将引发异常，这意味着你必须撤销其中一个现有证书来为新证书腾出空间。</p>
<p>设置Apple ID</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fastlane cert -u cert@krausefx.com</span><br></pre></td></tr></table></figure>
<p>在<code>lane</code>中使用</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cert(</span><br><span class="line">    development: true,</span><br><span class="line">    username: &quot;user@email.com&quot;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p><a href="#cert参数">更多<code>cert</code>参数</a></p>
<p><strong>注意：</strong><code>cert</code>无法从Apple Developer Portal下载现有证书+私钥，因为私钥永远不会离开你的计算机。</p>
<h6 id="sigh"><a href="#sigh" class="headerlink" title="sigh"></a>sigh</h6><p><code>sigh</code>执行的文件操作</p>
<p><img src="http://p9sc3003b.bkt.clouddn.com/2018-09-11-sighRecording.gif" alt="sighRecording"></p>
<p><code>sigh</code>将默认为App Store创建、修复和下载配置文件。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">fastlane sigh --appstore  # default</span><br><span class="line">fastlane sigh --adhoc</span><br><span class="line">fastlane sigh --development</span><br></pre></td></tr></table></figure>
<p>设置标识符和用户名：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fastlane sigh -a com.krausefx.app -u username</span><br></pre></td></tr></table></figure>
<p>在<code>lane</code>中使用</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">lane: beta do</span><br><span class="line">    sigh(</span><br><span class="line">        adhoc: true,</span><br><span class="line">        force: true,</span><br><span class="line">        filename: &quot;myFile.mobileprovision&quot;</span><br><span class="line">    )</span><br></pre></td></tr></table></figure>
<p><a href="#sigh参数">更多<code>sigh</code>参数</a></p>
<p><strong>注意：</strong><code>sigh</code>永远不会触及或使用由Xcode创建和管理的配置文件。相反，<code>sigh</code>将管理自己的一组配置文件。</p>
<p><code>sigh</code>将访问iOS Dev Center下载，续订或生成<code>.mobileprovision</code>文件。它使用<a href="https://spaceship.airforce/" target="_blank" rel="noopener">Spaceship</a>与Apple的Web服务进行通信。</p>
<h4 id="构建应用"><a href="#构建应用" class="headerlink" title="构建应用"></a>构建应用</h4><p>使用<code>gym</code>来构建和打包iOS App，它可以处理繁重的工作，并且轻松生成签名ipa和app文件</p>
<h5 id="基础用法"><a href="#基础用法" class="headerlink" title="基础用法"></a>基础用法</h5><p>使用<code>gym</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fastlane gym</span><br></pre></td></tr></table></figure>
<p>设置参数进行构建</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fastlane gym --workspace &quot;Example.xcworkspace&quot; --scheme &quot;AppName&quot; --clean</span><br></pre></td></tr></table></figure>
<p>如果您需要使用其他Xcode安装，请使用xcode-select或定义DEVELOPER_DIR：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DEVELOPER_DIR=&quot;/Applications/Xcode6.2.app&quot; fastlane gym</span><br></pre></td></tr></table></figure>
<p>如果需要上传到App Store或TestFlight，设置<code>gym</code>的导出方法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fastlane gym --export_method ad-hoc</span><br></pre></td></tr></table></figure>
<p>传递布尔参数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fastlane gym --include_bitcode true --include_symbols false</span><br></pre></td></tr></table></figure>
<p>需要<code>xcodebuild</code>原始日志信息，打开<code>~/Library/Logs/gym</code></p>
<h5 id="自动化构建流程"><a href="#自动化构建流程" class="headerlink" title="自动化构建流程"></a>自动化构建流程</h5><p>在<code>lane</code>中使用<code>gym</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">lane :beta do</span><br><span class="line">  scan</span><br><span class="line">  gym(scheme: &quot;MyApp&quot;)</span><br><span class="line">  crashlytics</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line"># error block is executed when a error occurs</span><br><span class="line">error do |lane, exception|</span><br><span class="line">  slack(</span><br><span class="line">    # message with short human friendly message</span><br><span class="line">    message: exception.to_s, </span><br><span class="line">    success: false, </span><br><span class="line">    # Output containing extended log output</span><br><span class="line">    payload: &#123; &quot;Output&quot; =&gt; exception.error_info.to_s &#125; </span><br><span class="line">  )</span><br><span class="line">end</span><br></pre></td></tr></table></figure>
<p>当<code>gym</code>引发错误时，<code>error_info</code>属性将包含进程输出，让你可以在第三方工具（如Slack）中显示错误。</p>
<p><a href="#gym参数">更多<code>gym</code>参数</a></p>
<p>然后，你可以轻松地公测提供商之间进行切换（例如testflight，hockey，s3和更多）。</p>
<h4 id="上传应用到分发平台"><a href="#上传应用到分发平台" class="headerlink" title="上传应用到分发平台"></a>上传应用到分发平台</h4><p>构建应用程序后，就可以将它上传到你选择的Beta测试服务中。fastlane的优雅之处在于你可以轻松地切换测试提供商，甚至可以一次上传到多个测试提供商，没有任何额外的工作。</p>
<p>你所要做的就是在使用<code>gym</code>构建应用程序后，将你选择的Beta测试提供程序添加到<code>lane</code>中：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">lane :beta do</span><br><span class="line">  match(type: &quot;appstore&quot;)    # see code signing guide for more information</span><br><span class="line">  gym(scheme: &quot;MyApp&quot;)</span><br><span class="line">  pilot</span><br><span class="line">  slack(message: &quot;Successfully distributed a new beta build&quot;)</span><br><span class="line">end</span><br></pre></td></tr></table></figure>
<p>fastlane会自动将生成的<code>.ipa</code>文件的信息从<code>gym</code>传递给你选择的Beta测试提供程序。</p>
<p>以下只列举几种常见的Beta测试服务，有关其他受支持的Beta测试服务的更多信息，请参阅<a href="https://docs.fastlane.tools/actions/#beta" target="_blank" rel="noopener">“Beta”操作列表</a></p>
<h5 id="TestFlight"><a href="#TestFlight" class="headerlink" title="TestFlight"></a>TestFlight</h5><p>你可以使用fastlane轻松地将新版本上传到TestFlight（它是App Store Connect的一部分）。为此，只需testflight在构建应用程序后使用内置操作即可</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">lane :beta do</span><br><span class="line">  # ...</span><br><span class="line">  gym</span><br><span class="line">  pilot</span><br><span class="line">end</span><br></pre></td></tr></table></figure>
<p>一些示例用例</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">lane :beta do</span><br><span class="line">  # ...</span><br><span class="line">  gym</span><br><span class="line"></span><br><span class="line">  # Variant 1: Provide a changelog to your build</span><br><span class="line">  pilot(changelog: &quot;Add rocket emoji&quot;)</span><br><span class="line"></span><br><span class="line">  # Variant 2: Skip the &quot;Waiting for processing&quot; of the binary</span><br><span class="line">  #   While this will speed up your build, it will not distribute</span><br><span class="line">  #   the binary to your tests, nor set a changelog</span><br><span class="line">  pilot(skip_waiting_for_build_processing: true)</span><br><span class="line">end</span><br></pre></td></tr></table></figure>
<p>如果你曾经<code>fastlane init</code>设置过fastlane，那么你的Apple ID将存储在<code>fastlane/Appfile</code>。你也可以使用覆盖用户名<code>pilot(username: &quot;bot@fastlane.tools&quot;)</code>。</p>
<p>使用fastlane，你还可以自动管理你的Beta版测试人员，查看<a href="https://docs.fastlane.tools/actions/upload_to_testflight/" target="_blank" rel="noopener">其他可用操作</a>。</p>
<h5 id="Crashlytics-Fabric-Beta）"><a href="#Crashlytics-Fabric-Beta）" class="headerlink" title="Crashlytics (Fabric Beta）"></a>Crashlytics (Fabric Beta）</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">lane :beta do</span><br><span class="line">  # ...</span><br><span class="line">  gym</span><br><span class="line">  crashlytics(api_token: &quot;[insert_key_here]&quot;,</span><br><span class="line">              build_secret: &quot;[insert_key_here]&quot;)</span><br><span class="line">end</span><br></pre></td></tr></table></figure>
<p>要获取API令牌，请打开<a href="https://www.fabric.io/settings/organizations" target="_blank" rel="noopener">组织设置页面</a>，然后单击API密钥并构建机密链接。</p>
<p><a href="https://docs.fastlane.tools/actions/crashlytics/" target="_blank" rel="noopener">更多<code>crashlytics</code>参数</a></p>
<h5 id="fir-im"><a href="#fir-im" class="headerlink" title="fir.im"></a>fir.im</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">lane :beta do</span><br><span class="line">    gym</span><br><span class="line">    firim(firim_api_token: &quot;427899702537eaadc5104ecbf5096d5c&quot;</span><br><span class="line">      )</span><br><span class="line">end</span><br></pre></td></tr></table></figure>
<p><a href="https://github.com/whlsxl/firim/tree/master/fastlane-plugin-firim" target="_blank" rel="noopener">更多插件信息</a></p>
<h5 id="蒲公英"><a href="#蒲公英" class="headerlink" title="蒲公英"></a>蒲公英</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">lane :beta do</span><br><span class="line">    gym</span><br><span class="line">    pgyer(api_key: &quot;7f15xxxxxxxxxxxxxxxxxx141&quot;,</span><br><span class="line">    user_key: &quot;4a5bcxxxxxxxxxxxxxxx3a9e&quot;</span><br><span class="line">    )</span><br><span class="line">end</span><br></pre></td></tr></table></figure>
<p><a href="https://github.com/shishirui/fastlane-plugin-pgyer" target="_blank" rel="noopener">更多插件信息</a></p>
<h4 id="提交应用到App-Store"><a href="#提交应用到App-Store" class="headerlink" title="提交应用到App Store"></a>提交应用到App Store</h4><p>构建应用程序后，就可以使用<code>deliver</code>上传到App Store了</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">lane: release do</span><br><span class="line">    match(type: &quot;appstore&quot;)  # see code signing guide for more information</span><br><span class="line">    gym(scheme: &quot;MyApp&quot;)</span><br><span class="line">    deliver                  # upload your app to App Store Connect</span><br><span class="line">    slack(message: &quot;Successfully uploaded a new App Store build&quot;)    </span><br><span class="line">end</span><br></pre></td></tr></table></figure>
<p>设置参数调用</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">deliver(</span><br><span class="line">  submit_for_review: true,</span><br><span class="line">  force: true,</span><br><span class="line">  metadata_path: &quot;./metadata&quot;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p><a href="https://docs.fastlane.tools/actions/upload_to_app_store/" target="_blank" rel="noopener">更多<code>deliver</code>参数</a></p>
<h2 id="扩展使用"><a href="#扩展使用" class="headerlink" title="扩展使用"></a>扩展使用</h2><h3 id="插件"><a href="#插件" class="headerlink" title="插件"></a>插件</h3><p>fastlane的插件系统是官方支持用户开发的开放平台，你可以根据你的需求自定义开发不同的插件，并在fastlane中使用。</p>
<h4 id="寻找一个插件"><a href="#寻找一个插件" class="headerlink" title="寻找一个插件"></a>寻找一个插件</h4><p>列出所有可用的插件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fastlane search_plugins</span><br></pre></td></tr></table></figure>
<p>搜索特定的插件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fastlane search_plugins [query]</span><br></pre></td></tr></table></figure>
<h4 id="在项目中添加插件"><a href="#在项目中添加插件" class="headerlink" title="在项目中添加插件"></a>在项目中添加插件</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fastlane add_plugin [name]</span><br></pre></td></tr></table></figure>
<p>运行此命令后，fastlane会帮你对项目进行设置以开始使用插件：</p>
<ul>
<li>添加插件配置文件<code>fastlane/Pluginfile</code></li>
<li>确保<code>fastlane/Pluginfile</code>的身份正确引用<code>./Gemfile</code></li>
<li>运行<code>fastlane install_plugins</code>以确保在本地计算机上安装了所有必需的依赖项（此步骤可能会要求你输入管理员密码以安装Ruby gem）</li>
<li>你将有3个新文件，这些文件都应该添加到版本控制中：<code>Gemfile</code>，<code>Gemfile.lock</code>和<code>fastlane/Pluginfile</code></li>
</ul>
<h4 id="在新机器上同步插件"><a href="#在新机器上同步插件" class="headerlink" title="在新机器上同步插件"></a>在新机器上同步插件</h4><p>要确保所有插件都安装在本地计算机上，请运行：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fastlane install_plugins</span><br></pre></td></tr></table></figure>
<h4 id="删除插件"><a href="#删除插件" class="headerlink" title="删除插件"></a>删除插件</h4><p>打开<code>fastlane/Pluginfile</code>文件，并删除文件中像这样的配置项：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gem &quot;fastlane-plugin-[plugin_name]&quot;</span><br></pre></td></tr></table></figure>
<h3 id="Appfile"><a href="#Appfile" class="headerlink" title="Appfile"></a>Appfile</h3><p><code>Appfile</code>必须存储在<code>./fastlane</code>目录中。</p>
<p>默认情况下的<code>Appfile</code>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">app_identifier &quot;net.sunapps.1&quot; # The bundle identifier of your app</span><br><span class="line">apple_id &quot;felix@krausefx.com&quot;  # Your Apple email address</span><br><span class="line"></span><br><span class="line"># You can uncomment the lines below and add your own</span><br><span class="line"># team selection in case you&apos;re in multiple teams</span><br><span class="line"># team_name &quot;Felix Krause&quot;</span><br><span class="line"># team_id &quot;Q2CBPJ58CA&quot;</span><br><span class="line"></span><br><span class="line"># To select a team for App Store Connect use</span><br><span class="line"># itc_team_name &quot;Company Name&quot;</span><br><span class="line"># itc_team_id &quot;18742801&quot;</span><br></pre></td></tr></table></figure>
<p>如果你的App Store Connect和Apple Developer账号不相同，使用以下代码配置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">app_identifier &quot;tools.fastlane.app&quot;       # The bundle identifier of your app</span><br><span class="line"></span><br><span class="line">apple_dev_portal_id &quot;portal@company.com&quot;  # Apple Developer Account</span><br><span class="line">itunes_connect_id &quot;tunes@company.com&quot;     # App Store Connect Account</span><br><span class="line"></span><br><span class="line">team_id &quot;Q2CBPJ58CA&quot; # Developer Portal Team ID</span><br><span class="line">itc_team_id &quot;18742801&quot; # App Store Connect Team ID</span><br></pre></td></tr></table></figure>
<p>如果你的项目每个环境都具有不同的包标识符（即beta，app store），则可以使用<code>for_platform</code>和<code>/</code>或<code>for_lane</code>块声明来定义它。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">app_identifier &quot;net.sunapps.1&quot;</span><br><span class="line">apple_id &quot;felix@krausefx.com&quot;</span><br><span class="line">team_id &quot;Q2CBPJ58CC&quot;</span><br><span class="line"></span><br><span class="line">for_platform :ios do</span><br><span class="line">  team_id &apos;123&apos; # for all iOS related things</span><br><span class="line">  for_lane :test do</span><br><span class="line">    app_identifier &apos;com.app.test&apos;</span><br><span class="line">  end</span><br><span class="line">end</span><br></pre></td></tr></table></figure>
<h4 id="在fastlane中使用Appfile中的配置"><a href="#在fastlane中使用Appfile中的配置" class="headerlink" title="在fastlane中使用Appfile中的配置"></a>在fastlane中使用Appfile中的配置</h4><p>在<code>Fastfile</code>中访问这些配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">identifier = CredentialsManager::AppfileConfig.try_fetch_value(:app_identifier)</span><br><span class="line">team_id = CredentialsManager::AppfileConfig.try_fetch_value(:team_id)</span><br></pre></td></tr></table></figure>
<h3 id="使用Gemfile进行依赖管理"><a href="#使用Gemfile进行依赖管理" class="headerlink" title="使用Gemfile进行依赖管理"></a>使用Gemfile进行依赖管理</h3><p><code>Gemfile</code>明确定义使用的fastlane版本和依赖关系，并且能让fastlane使用更迅速。</p>
<ul>
<li><p>在项目的根目录创建一个<code>Gemfile</code>文件</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">source &quot;https://rubygems.org&quot;</span><br><span class="line">gem &quot;fastlane&quot;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li>运行<code>sudo bundle update</code>同时添加<code>./Gemfile</code>和<code>./Gemfile.lock</code>版本控制文件</li>
<li>每次运行fastlane时，请使用<code>bundle exec fastlane [lane]</code></li>
<li>在CI上，添加<code>sudo bundle install</code>作为第一个构建步骤</li>
<li>要更新fastlane，请运行<code>sudo bundle update fastlane</code></li>
</ul>
<h3 id="pem推送证书"><a href="#pem推送证书" class="headerlink" title="pem推送证书"></a>pem推送证书</h3><p><code>pem</code>执行的文件操作</p>
<p><img src="http://p9sc3003b.bkt.clouddn.com/2018-09-12-PEMRecording.gif" alt="PEMRecording"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fastlane pem</span><br></pre></td></tr></table></figure>
<p>命令会执行如下操作：</p>
<ul>
<li>创建新的签名请求</li>
<li>创建新的推送认证</li>
<li>下载证书</li>
<li><code>.pem</code>在当前工作目录中生成一个新文件，你可以将其上传到服务器</li>
</ul>
<p>请注意，pem永远不会撤销你现有的证书。pem无法下载任何现有的推送证书，因为私钥仅在其创建的计算机上可用。</p>
<p>如果你已启用推送证书，该证书至少有30天有效，则pem不会创建新证书。如果你仍想创建一个，请使用force：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fastlane pem --force</span><br></pre></td></tr></table></figure>
<p>你可以传递这样的参数：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fastlane pem -a com.krausefx.app -u username</span><br></pre></td></tr></table></figure>
<p>如果要生成开发证书，请执行以下操作：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fastlane pem --development</span><br></pre></td></tr></table></figure>
<p>为你的p12文件设置密码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fastlane pem -p &quot;MyPass&quot;</span><br></pre></td></tr></table></figure>
<p>你可以为输出文件指定名称：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fastlane pem -o my.pem</span><br></pre></td></tr></table></figure>
<p>在<code>lane</code>中使用</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">pem(</span><br><span class="line">  force: true, # create a new profile, even if the old one is still valid</span><br><span class="line">  app_identifier: &quot;net.sunapps.9&quot;, # optional app identifier,</span><br><span class="line">  save_private_key: true,</span><br><span class="line">  new_profile: proc do |profile_path| # this block gets called when a new profile was generated</span><br><span class="line">    puts profile_path # the absolute path to the new PEM file</span><br><span class="line">    # insert the code to upload the PEM file to the server</span><br><span class="line">  end</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p><a href="#pem参数">更多<code>pem</code>参数</a></p>
<h3 id="增加内部版本号"><a href="#增加内部版本号" class="headerlink" title="增加内部版本号"></a>增加内部版本号</h3><p>在TestFlight和App Store中，每次上传新版本时都必须增加内部版本号。</p>
<h4 id="Beta内部版本号"><a href="#Beta内部版本号" class="headerlink" title="Beta内部版本号"></a>Beta内部版本号</h4><p>下面的代码示例将使用TestFlight中的最新版本号并临时设置它。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">lane :beta do</span><br><span class="line">  increment_build_number(</span><br><span class="line">    build_number: latest_testflight_build_number + 1,</span><br><span class="line">    xcodeproj: &quot;Example.xcodeproj&quot;</span><br><span class="line">  )</span><br><span class="line">end</span><br></pre></td></tr></table></figure>
<p>将构建号提交给版本控制</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">lane :beta do</span><br><span class="line">  # Ensure that your git status is not dirty</span><br><span class="line">  ensure_git_status_clean</span><br><span class="line"></span><br><span class="line">  # Increment the build number (not the version number)</span><br><span class="line">  # Providing the xcodeproj is optional</span><br><span class="line">  increment_build_number(xcodeproj: &quot;Example.xcodeproj&quot;)</span><br><span class="line"></span><br><span class="line">  # Commit the version bump</span><br><span class="line">  commit_version_bump(xcodeproj: &quot;Example.xcodeproj&quot;)</span><br><span class="line"></span><br><span class="line">  # Add a git tag for this build. This will automatically</span><br><span class="line">  # use an appropriate git tag name</span><br><span class="line">  add_git_tag</span><br><span class="line"></span><br><span class="line">  # Push the new commit and tag back to your git remote</span><br><span class="line">  push_to_git_remote</span><br><span class="line">end</span><br></pre></td></tr></table></figure>
<h4 id="App-Store内部版本号"><a href="#App-Store内部版本号" class="headerlink" title="App Store内部版本号"></a>App Store内部版本号</h4><p>下面的代码示例将使用App Store Connect中的最新版本号并临时设置它。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">lane :beta do</span><br><span class="line">  increment_build_number(</span><br><span class="line">    build_number: app_store_build_number + 1,</span><br><span class="line">    xcodeproj: &quot;Example.xcodeproj&quot;</span><br><span class="line">  )</span><br><span class="line">end</span><br></pre></td></tr></table></figure>
<h3 id="第三方Beta测试服务"><a href="#第三方Beta测试服务" class="headerlink" title="第三方Beta测试服务"></a>第三方Beta测试服务</h3><p>如果你不是使用TestFlight作为测试服务，则需要管理已注册的设备及其UDID。fastlane已经支持设备注册和更新配置文件。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">lane :beta do</span><br><span class="line">  # Before calling match, we make sure all our devices are registered on the Apple Developer Portal</span><br><span class="line">  register_devices(devices_file: &quot;devices.txt&quot;)</span><br><span class="line"></span><br><span class="line">  # After registering the new devices, we&apos;ll make sure to update the provisioning profile if necessary</span><br><span class="line">  # Note how we make sure to pass &quot;adhoc&quot; to get and use a provisioning profile for Ad Hoc distribution</span><br><span class="line">  sync_code_signing(force_for_new_devices: true, type: &quot;adhoc&quot;)</span><br><span class="line">  build_app</span><br><span class="line">  # ...</span><br><span class="line">end</span><br></pre></td></tr></table></figure>
<p><code>devices.txt</code>应该是这样的：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Device ID Device Name</span><br><span class="line">A123456789012345678901234567890123456789  DeviceName1</span><br><span class="line">B123456789012345678901234567890123456789  DeviceName2</span><br></pre></td></tr></table></figure>
<h2 id="参数表"><a href="#参数表" class="headerlink" title="参数表"></a>参数表</h2><h3 id="cert参数"><a href="#cert参数" class="headerlink" title="cert参数"></a>cert参数</h3><table>
<thead>
<tr>
<th>键</th>
<th>描述</th>
<th>默认值</th>
</tr>
</thead>
<tbody>
<tr>
<td>development</td>
<td>创建开发证书而不是分发证书</td>
<td>false</td>
</tr>
<tr>
<td>force</td>
<td>即使存在现有证书，也要创建证书</td>
<td>false</td>
</tr>
<tr>
<td>username</td>
<td>您的Apple ID用户名</td>
<td>*</td>
</tr>
<tr>
<td>team_id</td>
<td>如果您在多个团队中，您的Developer Portal团队的ID</td>
<td>*</td>
</tr>
<tr>
<td>team_name</td>
<td>如果您在多个团队中，您的Developer Portal团队的名称</td>
<td>*</td>
</tr>
<tr>
<td>filename</td>
<td>要存储的证书的文件名</td>
<td></td>
</tr>
<tr>
<td>output_path</td>
<td>应存储所有证书和私钥的目录的路径</td>
<td>.</td>
</tr>
<tr>
<td>keychain_path</td>
<td>自定义钥匙串的路径</td>
<td>*</td>
</tr>
<tr>
<td>keychain_password</td>
<td>首次访问新mac上的证书时可能需要这样做。对于登录/默认钥匙串，这是您的帐户密码</td>
<td></td>
</tr>
<tr>
<td>platform</td>
<td>设置配置文件的平台（ios，macos）</td>
<td>ios</td>
</tr>
</tbody>
</table>
<h3 id="sigh参数"><a href="#sigh参数" class="headerlink" title="sigh参数"></a>sigh参数</h3><table>
<thead>
<tr>
<th>键</th>
<th>描述</th>
<th>默认值</th>
</tr>
</thead>
<tbody>
<tr>
<td>adhoc</td>
<td>设置此标志将生成AdHoc配置文件而不是App Store配置文件</td>
<td>false</td>
</tr>
<tr>
<td>development</td>
<td>更新开发证书而不是生产证书</td>
<td>false</td>
</tr>
<tr>
<td>skip_install</td>
<td>默认情况下，证书将添加到本地计算机。设置此标志将跳过此操作</td>
<td>false</td>
</tr>
<tr>
<td>force</td>
<td>无论状态如何，都可以续订配置文件 - 自动为临时配置文件添加所有设备</td>
<td>false</td>
</tr>
<tr>
<td>app_identifier</td>
<td>您应用的捆绑包标识符</td>
<td>*</td>
</tr>
<tr>
<td>username</td>
<td>您的Apple ID用户名</td>
<td>*</td>
</tr>
<tr>
<td>team_id</td>
<td>如果您在多个团队中，您的Developer Portal团队的ID</td>
<td>*</td>
</tr>
<tr>
<td>team_name</td>
<td>如果您在多个团队中，您的Developer Portal团队的名称</td>
<td>*</td>
</tr>
<tr>
<td>provisioning_name</td>
<td>Apple Developer Portal上使用的配置文件的名称</td>
<td></td>
</tr>
<tr>
<td>ignore_profiles_with_different_name</td>
<td>与：provisioning_name结合使用 - 当为true时，仅下载与此确切名称匹配的配置文件</td>
<td>false</td>
</tr>
<tr>
<td>output_path</td>
<td>应存储配置文件的目录</td>
<td>.</td>
</tr>
<tr>
<td>cert_id</td>
<td>要使用的代码签名证书的ID（例如78ADL6LVAA）</td>
<td></td>
</tr>
<tr>
<td>cert_owner_name</td>
<td>用于新配置文件或续订的证书名称。（例如“Felix Krause”）</td>
<td></td>
</tr>
<tr>
<td>filename</td>
<td>用于生成的配置文件的文件名（必须包含.mobileprovision）</td>
<td></td>
</tr>
<tr>
<td>skip_fetch_profiles</td>
<td>跳过现有配置文件的验证，如果您有数千个配置文件，这将非常有用</td>
<td>false</td>
</tr>
<tr>
<td>skip_certificate_verification</td>
<td>跳过每个现有配置文件的证书验证。这将确保可以在本地计算机上使用配置文件</td>
<td>false</td>
</tr>
<tr>
<td>platform</td>
<td>设置配置文件的平台（即ios，tvos）</td>
<td>ios</td>
</tr>
<tr>
<td>readonly</td>
<td>仅获取现有配置文件，不生成新配置文件</td>
<td>false</td>
</tr>
<tr>
<td>template_name</td>
<td>配置文件模板的名称。如果开发者帐户具有配置配置文件模板（又名：自定义权利），则可以通过在创建/编辑配置文件时检查权利下拉列表来找到模板名称（例如“Apple Pay Pass Suppression Development”）</td>
<td></td>
</tr>
</tbody>
</table>
<h3 id="gym参数"><a href="#gym参数" class="headerlink" title="gym参数"></a>gym参数</h3><table>
<thead>
<tr>
<th>键</th>
<th>描述</th>
<th>默认值</th>
</tr>
</thead>
<tbody>
<tr>
<td>workspace</td>
<td>工作区文件的路径</td>
<td></td>
</tr>
<tr>
<td>project</td>
<td>项目文件的路径</td>
<td></td>
</tr>
<tr>
<td>scheme</td>
<td>该项目的scheme。确保它标记为Shared</td>
<td></td>
</tr>
<tr>
<td>clean</td>
<td>项目在建造之前是否应该进行Clean？</td>
<td>false</td>
</tr>
<tr>
<td>output_directory</td>
<td>应存储ipa文件的目录</td>
<td>.</td>
</tr>
<tr>
<td>output_name</td>
<td>生成的ipa文件的名称</td>
<td></td>
</tr>
<tr>
<td>configuration</td>
<td>构建应用程序时使用的配置。默认为’Release’</td>
<td>*</td>
</tr>
<tr>
<td>silent</td>
<td>隐藏构建时不必要的所有信息</td>
<td>false</td>
</tr>
<tr>
<td>codesigning_identity</td>
<td>要使用的代码签名标识的名称。它必须与名称完全匹配。例如’iPhone Distribution：SunApps GmbH’</td>
<td></td>
</tr>
<tr>
<td>skip_package_ipa</td>
<td>我们应该跳过包装ipa吗？</td>
<td>false</td>
</tr>
<tr>
<td>include_symbols</td>
<td>ipa文件应该包含符号吗？</td>
<td></td>
</tr>
<tr>
<td>include_bitcode</td>
<td>ipa文件应该包含bitcode吗？</td>
<td></td>
</tr>
<tr>
<td>export_method</td>
<td>用于导出存档的方法。有效值包括：app-store，ad-hoc，package，enterprise，development，developer-id</td>
<td></td>
</tr>
<tr>
<td>export_options</td>
<td>导出选项plist的路径或带导出选项的哈希。使用’xcodebuild -help’打印全套可用选项</td>
<td></td>
</tr>
<tr>
<td>export_xcargs</td>
<td>将附加参数传递给xcodebuild以获取包阶段。请务必引用设置名称和值，例如OTHER_LDFLAGS =“ - ObjC -lstdc ++”</td>
<td></td>
</tr>
<tr>
<td>skip_build_archive</td>
<td>从以前构建的xarchive导出ipa。使用archive_path作为源</td>
<td></td>
</tr>
<tr>
<td>skip_archive</td>
<td>构建之后，不要归档，实际上不包括-archivePath参数</td>
<td></td>
</tr>
<tr>
<td>build_path</td>
<td>存档应存储在的目录</td>
<td></td>
</tr>
<tr>
<td>archive_path</td>
<td>创建存档的路径</td>
<td></td>
</tr>
<tr>
<td>derived_data_path</td>
<td>构建产品和其他派生数据的目录</td>
<td></td>
</tr>
<tr>
<td>result_bundle</td>
<td>是否应在输出目录中生成Xcode结果包</td>
<td>false</td>
</tr>
<tr>
<td>buildlog_path</td>
<td>存储构建日志的目录</td>
<td>*</td>
</tr>
<tr>
<td>sdk</td>
<td>应该用于构建应用程序的SDK</td>
<td></td>
</tr>
<tr>
<td>toolchain</td>
<td>应该用于构建应用程序的工具链（例如com.apple.dt.toolchain.Swift_2_3,org.swift.30p620160816a）</td>
<td></td>
</tr>
<tr>
<td>destination</td>
<td>使用自定义目标构建应用程序</td>
<td></td>
</tr>
<tr>
<td>export_team_id</td>
<td>可选：有时您需要在导出ipa文件时指定团队ID</td>
<td></td>
</tr>
<tr>
<td>xcargs</td>
<td>将其他参数传递给xcodebuild以进行构建阶段。请务必引用设置名称和值，例如OTHER_LDFLAGS =“ - ObjC -lstdc ++”</td>
<td></td>
</tr>
<tr>
<td>xcconfig</td>
<td>使用额外的XCCONFIG文件来构建您的应用程序</td>
<td></td>
</tr>
<tr>
<td>suppress_xcode_output</td>
<td>将xcodebuild的输出抑制为stdout。输出仍保存在buildlog_path中</td>
<td></td>
</tr>
<tr>
<td>disable_xcpretty</td>
<td>禁用构建输出的xcpretty格式</td>
<td></td>
</tr>
<tr>
<td>xcpretty_test_format</td>
<td>使用测试（RSpec样式）格式进行构建输出</td>
<td></td>
</tr>
<tr>
<td>xcpretty_formatter</td>
<td>要使用的自定义xcpretty格式化程序</td>
<td></td>
</tr>
<tr>
<td>xcpretty_report_junit</td>
<td>让xcpretty在提供的路径上创建一个JUnit样式的XML报告</td>
<td></td>
</tr>
<tr>
<td>xcpretty_report_html</td>
<td>让xcpretty在提供的路径上创建一个简单的HTML报告</td>
<td></td>
</tr>
<tr>
<td>xcpretty_report_json</td>
<td>让xcpretty在提供的路径上创建JSON编译数据库</td>
<td></td>
</tr>
<tr>
<td>analyze_build_time</td>
<td>分析项目构建时间并将输出存储在’culprits.txt’文件中</td>
<td></td>
</tr>
<tr>
<td>xcpretty_utf</td>
<td>报告构建时，xcpretty使用unicode编码</td>
<td></td>
</tr>
<tr>
<td>skip_profile_detection</td>
<td>不要尝试从xcodeproj构建配置文件映射。应使用匹配或手动提供的映射</td>
<td>false</td>
</tr>
</tbody>
</table>
<h3 id="pem参数"><a href="#pem参数" class="headerlink" title="pem参数"></a>pem参数</h3><table>
<thead>
<tr>
<th>键</th>
<th>描述</th>
<th>默认值</th>
</tr>
</thead>
<tbody>
<tr>
<td>development</td>
<td>更新开发推送证书而不是生产证书</td>
<td>false</td>
</tr>
<tr>
<td>generate_p12</td>
<td>另外为PEM文件生成p12文件</td>
<td>true</td>
</tr>
<tr>
<td>active_days_limit</td>
<td>如果当前证书的有效期少于此天数，则生成一个新证书</td>
<td>30</td>
</tr>
<tr>
<td>force</td>
<td>创建一个新的推送证书，即使当前的证书有效30天（或PEM_ACTIVE_DAYS_LIMIT）更多天</td>
<td>false</td>
</tr>
<tr>
<td>save_private_key</td>
<td>设置为保存私有RSA密钥</td>
<td>true</td>
</tr>
<tr>
<td>app_identifier</td>
<td>您应用的捆绑包标识符</td>
<td>*</td>
</tr>
<tr>
<td>username</td>
<td>您的Apple ID用户名</td>
<td>*</td>
</tr>
<tr>
<td>team_id</td>
<td>如果您在多个团队中，您的Developer Portal团队的ID</td>
<td>*</td>
</tr>
<tr>
<td>team_name</td>
<td>如果您在多个团队中，您的Developer Portal团队的名称</td>
<td>*</td>
</tr>
<tr>
<td>p12_password</td>
<td>用于p12文件的密码</td>
<td>‘’</td>
</tr>
<tr>
<td>pem_name</td>
<td>生成的.pem文件的文件名</td>
<td></td>
</tr>
<tr>
<td>output_path</td>
<td>应存储所有证书和私钥的目录的路径</td>
<td>.</td>
</tr>
<tr>
<td>new_profile</td>
<td>如果有新的配置文件，则调用阻止</td>
<td></td>
</tr>
</tbody>
</table>
<h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><ul>
<li><a href="https://docs.fastlane.tools/getting-started/ios/setup/" target="_blank" rel="noopener">设置fastlane</a></li>
<li><a href="https://docs.fastlane.tools/plugins/create-plugin/#fastlane-plugins" target="_blank" rel="noopener">fastlane插件</a></li>
<li><a href="https://docs.fastlane.tools/advanced/Appfile/" target="_blank" rel="noopener">Appfile</a></li>
<li><a href="https://bundler.io/gemfile.html" target="_blank" rel="noopener">Gemfile</a></li>
<li><a href="https://docs.fastlane.tools/actions/sigh/" target="_blank" rel="noopener">sigh</a></li>
<li><a href="https://docs.fastlane.tools/actions/cert/" target="_blank" rel="noopener">cert</a></li>
<li><a href="https://docs.fastlane.tools/actions/gym/" target="_blank" rel="noopener">gym</a></li>
<li><a href="https://docs.fastlane.tools/getting-started/ios/beta-deployment/" target="_blank" rel="noopener">iOS Beta Deployment using fastlane</a></li>
<li><a href="https://docs.fastlane.tools/actions/pilot/" target="_blank" rel="noopener">pilot</a> </li>
<li><a href="https://docs.fastlane.tools/actions/crashlytics/" target="_blank" rel="noopener">crashlytics</a></li>
<li><a href="http://try.crashlytics.com/beta/" target="_blank" rel="noopener">Crashlytics Beta</a></li>
<li><a href="https://github.com/fastlane/boarding#readme" target="_blank" rel="noopener">boarding</a></li>
<li><a href="https://docs.fastlane.tools/actions/upload_to_app_store/" target="_blank" rel="noopener">deliver</a></li>
</ul>

      
    </div>
    
    
    

    

    

    
      <div>
        <ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者：</strong>
    Zrocky
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="http://zrocky.com/2018/fastlane/" title="使用fastlane自动部署iOS App">http://zrocky.com/2018/fastlane/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>
    本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明出处！
  </li>
</ul>

      </div>
    

    <footer class="post-footer">
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/how-to-use-fastlane-match/" rel="next" title="fastlane之使用match同步证书和配置文件">
                <i class="fa fa-chevron-left"></i> fastlane之使用match同步证书和配置文件
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2018/how-to-use-git/" rel="prev" title="使用Git进行版本控制">
                使用Git进行版本控制 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.jpg"
               alt="Zrocky" />
          <p class="site-author-name" itemprop="name">Zrocky</p>
           
              <p class="site-description motion-element" itemprop="description">Think Different</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives/">
                <span class="site-state-item-count">10</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">5</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#基本使用"><span class="nav-number">1.</span> <span class="nav-text">基本使用</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#安装fastlane"><span class="nav-number">1.1.</span> <span class="nav-text">安装fastlane</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#初始化fastlane"><span class="nav-number">1.2.</span> <span class="nav-text">初始化fastlane</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#使用fastlane发布iOS-App"><span class="nav-number">1.3.</span> <span class="nav-text">使用fastlane发布iOS App</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#初识lane"><span class="nav-number">1.3.1.</span> <span class="nav-text">初识lane</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#代码签名"><span class="nav-number">1.3.2.</span> <span class="nav-text">代码签名</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#match"><span class="nav-number">1.3.2.1.</span> <span class="nav-text">match</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#cert和sigh"><span class="nav-number">1.3.2.2.</span> <span class="nav-text">cert和sigh</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#cert"><span class="nav-number">1.3.2.2.1.</span> <span class="nav-text">cert</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#sigh"><span class="nav-number">1.3.2.2.2.</span> <span class="nav-text">sigh</span></a></li></ol></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#构建应用"><span class="nav-number">1.3.3.</span> <span class="nav-text">构建应用</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#基础用法"><span class="nav-number">1.3.3.1.</span> <span class="nav-text">基础用法</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#自动化构建流程"><span class="nav-number">1.3.3.2.</span> <span class="nav-text">自动化构建流程</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#上传应用到分发平台"><span class="nav-number">1.3.4.</span> <span class="nav-text">上传应用到分发平台</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#TestFlight"><span class="nav-number">1.3.4.1.</span> <span class="nav-text">TestFlight</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Crashlytics-Fabric-Beta）"><span class="nav-number">1.3.4.2.</span> <span class="nav-text">Crashlytics (Fabric Beta）</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#fir-im"><span class="nav-number">1.3.4.3.</span> <span class="nav-text">fir.im</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#蒲公英"><span class="nav-number">1.3.4.4.</span> <span class="nav-text">蒲公英</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#提交应用到App-Store"><span class="nav-number">1.3.5.</span> <span class="nav-text">提交应用到App Store</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#扩展使用"><span class="nav-number">2.</span> <span class="nav-text">扩展使用</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#插件"><span class="nav-number">2.1.</span> <span class="nav-text">插件</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#寻找一个插件"><span class="nav-number">2.1.1.</span> <span class="nav-text">寻找一个插件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#在项目中添加插件"><span class="nav-number">2.1.2.</span> <span class="nav-text">在项目中添加插件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#在新机器上同步插件"><span class="nav-number">2.1.3.</span> <span class="nav-text">在新机器上同步插件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#删除插件"><span class="nav-number">2.1.4.</span> <span class="nav-text">删除插件</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Appfile"><span class="nav-number">2.2.</span> <span class="nav-text">Appfile</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#在fastlane中使用Appfile中的配置"><span class="nav-number">2.2.1.</span> <span class="nav-text">在fastlane中使用Appfile中的配置</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#使用Gemfile进行依赖管理"><span class="nav-number">2.3.</span> <span class="nav-text">使用Gemfile进行依赖管理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#pem推送证书"><span class="nav-number">2.4.</span> <span class="nav-text">pem推送证书</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#增加内部版本号"><span class="nav-number">2.5.</span> <span class="nav-text">增加内部版本号</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Beta内部版本号"><span class="nav-number">2.5.1.</span> <span class="nav-text">Beta内部版本号</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#App-Store内部版本号"><span class="nav-number">2.5.2.</span> <span class="nav-text">App Store内部版本号</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#第三方Beta测试服务"><span class="nav-number">2.6.</span> <span class="nav-text">第三方Beta测试服务</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#参数表"><span class="nav-number">3.</span> <span class="nav-text">参数表</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#cert参数"><span class="nav-number">3.1.</span> <span class="nav-text">cert参数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#sigh参数"><span class="nav-number">3.2.</span> <span class="nav-text">sigh参数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#gym参数"><span class="nav-number">3.3.</span> <span class="nav-text">gym参数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#pem参数"><span class="nav-number">3.4.</span> <span class="nav-text">pem参数</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#参考链接"><span class="nav-number">4.</span> <span class="nav-text">参考链接</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Zrocky</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.2"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.2"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.2"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.2"></script>



  


  




	





  





  






  





  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.4.js"></script>
  <script>AV.initialize("OQgH6KJnEig7znuzN5oyRs2s-gzGzoHsz", "YSdUunmrX0Nv5YF1jN3lhU9R");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  

  

  

  

</body>
</html>
